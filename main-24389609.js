(()=>{var __webpack_modules__={207:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<footer class="footer">\n  <div class="container footer__container">\n    '),__append(__webpack_require__(651)()),__append('\n\n    <div class="footer__right">\n      <a class="github-link" href="https://github.com/tretyakov-a">\n        <span class="github-link__icon">\n          <i class="fa-brands fa-github"></i>\n        </span>\n        <span class="github-link__text">Tretyakov Alexander</span>\n      </a>\n      <span class="footer__year">\n        2023\n      </span>\n    </div>\n  </div>\n</footer>\n');return __output}},319:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<header class="header">\n  <div class="container header__container">\n    <nav class="header__help">\n      <button class="button" data-tab-button="help">\n        <i class="fa-regular fa-circle-question"></i>\n      </button>\n    </nav>\n    <div class="header__title">Minesweeper</div>\n    <nav class="header__toolbar">\n      <button class="button" data-tab-button="stats">\n        <i class="fa-solid fa-chart-column"></i>\n      </button>\n      <button class="button" data-tab-button="settings">\n        <i class="fa-solid fa-gears"></i>\n      </button>\n    </nav>\n  </div>\n</header>\n');return __output}},544:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<main class="main">\n  <div class="container main__container">\n    <div id="game">\n    </div>\n  </div>\n</main>');return __output}},125:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="menu__content help">\n  <h3 class="menu__title">How to play</h3>\n  <p>In Minesweeper, mines (that resemble naval mines in the classic theme) are scattered throughout a board, which is divided into cells. Cells have three states: uncovered, covered and flagged. A covered cell is blank and clickable, while an uncovered cell is exposed. Flagged cells are those marked by the player to indicate a potential mine location.</p>\n  <p>A player left-clicks a cell to uncover it. If a player uncovers a mined cell, the game ends, as there is only 1 life per game. Otherwise, the uncovered cell displays either a number, indicating the number of mines diagonally and/or adjacent to it, or a blank tile (or "0"), and all adjacent non-mined cells will automatically be uncovered. Right-clicking on a cell will flag it, causing a flag to appear on it. Flagged cells are still considered covered, and a player can click on them to uncover them, although typically they must first be unflagged with an additional right-click.</p>\n  <p>The first click in any game will never be a mine.</p>\n  <p>To win the game, players must uncover all non-mine cells, at which point, the timer is stopped. Flagging all the mined cells is not required</p>\n  <div class="help__learn-more-link">\n    <a href="https://en.wikipedia.org/wiki/Minesweeper_(video_game)" target="_blank">\n      <i class="fa-solid fa-arrow-up-right-from-square"></i>\n      <span>Learn more...</span>\n    </a>\n  </div>\n</div>');return __output}},810:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="modal menu">\n  <div class="modal__overlay menu__overlay">\n    <div class="modal__window menu__window">\n      <ul class="menu__list">\n        <li class="menu__list-item" data-tab="help">\n          '),__append(__webpack_require__(125)()),__append('\n        </li>\n        <li class="menu__list-item" data-tab="stats">\n          '),__append(__webpack_require__(6)()),__append('\n        </li>\n        <li class="menu__list-item" data-tab="settings">\n          '),__append(__webpack_require__(742)()),__append("\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>");return __output}},742:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="menu__content settings">\n  <h3 class="menu__title">Settings</h3>\n\n  <form class="settings__form">\n\n    <div class="settings__row">\n      <div class="settings__title">\n        Theme\n      </div>\n      <div class="settings__input">\n        <select name="theme" id="theme">\n          <option value="light">light</option>\n          <option value="dark">dark</option>\n        </select>\n      </div>\n    </div>\n\n    <div class="settings__row">\n      <div class="settings__title">\n        Volume\n      </div>\n      <div class="settings__input">\n        <div class="volume">\n          <div class="volume__bar-container" title="Volume 10%">\n            <div class="volume__bar"></div>\n            <div class="volume__thumb"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <div class="settings__delimiter"></div>\n\n    <div class="settings__row">\n      <div class="settings__title">\n        Difficulty\n      </div>\n      <div class="settings__input">\n        <select name="difficulty" id="difficulty">\n          <option value="easy">easy</option>\n          <option value="medium">medium</option>\n          <option value="expert">expert</option>\n        </select>\n      </div>\n    </div>\n\n    <div class="settings__row">\n      <div class="settings__title">\n        Number of mines\n      </div>\n      <div class="settings__input">\n        <div class="mines-input">\n          <input class="mines-input__number" type="number" name="mines" id="mines" min="10" max="99">\n        </div>\n      </div>\n    </div>\n\n    <button class="button settings__button" type="submit">Apply</button>\n    \n  </form>\n</div>');return __output}},6:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="menu__content stats">\n  <h3 class="menu__title">Statistics</h3>\n  <div class="stats__content">\n    <header class="stats__header">\n      <div class="stats__tab-title" data-stats-tab-title="easy">Easy</div>\n      <div class="stats__tab-title" data-stats-tab-title="medium">Medium</div>\n      <div class="stats__tab-title" data-stats-tab-title="expert">Expert</div>\n    </header>\n    <div class="stats__body">\n      <div class="stats__tab" data-stats-tab="easy"></div>\n      <div class="stats__tab" data-stats-tab="medium"></div>\n      <div class="stats__tab" data-stats-tab="expert"></div>\n    </div>\n  </div>\n</div>');return __output}},389:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})locals.stats.length>0?(__append('\n<ul class="stats__list">\n  <li class="stats__list-item">\n    <span class="stats__date">Date</span>\n    <span class="stats__time">Time (sec)</span>\n    <span class="stats__clicks">Clicks</span>\n  </li>\n  '),locals.stats.forEach((function(stat){__append('\n    <li class="stats__list-item">\n      <span class="stats__date">'),__append(escapeFn(stat.date)),__append('</span>\n      <span class="stats__time">'),__append(escapeFn(stat.time)),__append('</span>\n      <span class="stats__clicks">'),__append(escapeFn(stat.clicks)),__append("</span>\n    </li>\n  ")})),__append("\n</ul>\n")):__append("\n<div>There is no stats availible for this difficulty. Try to play some games</div>\n");return __output}},823:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="modal__close-btn button">\n  <i class="far fa-times-circle"></i>\n</div>');return __output}},851:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="results__content-row">\n  <span class="results__content-title">Difficulty:</span>\n  <span class="results__content-data">'),__append(escapeFn(locals.difficulty)),__append('</span>\n</div>\n<div class="results__content-block">\n  <div class="results__content-row no-underline">\n    <span class="results__content-title">Time:</span>\n    <span class="results__content-data">'),__append(escapeFn(locals.time)),__append(' <span class="units">sec</span></span>\n  </div>\n  '),locals.isNewBestTime&&(__append('\n  <div class="results__content-new-record-row">\n    New Record! '),null!==locals.difference&&(__append("<span>(-"),__append(escapeFn(locals.difference)),__append(" sec)</span>")),__append("\n  </div>\n  ")),__append('\n</div>\n<div class="results__content-block">\n  <div class="results__content-row no-underline">\n    <div class="results__content-title">Clicks:</div>\n  </div>\n  <div class="results__content-sub-row">\n    <span class="results__content-title">Left:</span>\n    <span class="results__content-data">\n      '),__append(escapeFn(locals.clicks.left)),__append('\n    </span>\n  </div>\n  <div class="results__content-info-row">\n    (<span>'),__append(escapeFn(locals.clicks.chords)),__append(" chords</span>,\n    <span>"),__append(escapeFn(locals.clicks.wasted)),__append(' wasted</span>)\n  </div>\n  <div class="results__content-sub-row">\n    <span class="results__content-title">Right:</span>\n    <span class="results__content-data">'),__append(escapeFn(locals.clicks.right)),__append("</span>\n  </div>\n</div>");return __output}},504:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="modal results">\n  <div class="modal__overlay">\n    <div class="modal__window results__window">\n      <div class="results__title"></div>\n      <div class="results__content">\n      </div>\n    </div>\n  </div>\n</div>');return __output}},695:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<img class="results__title-img" src="'),__append(escapeFn(locals.imgSrc)),__append('" alt="'),__append(escapeFn(locals.text)),__append('">\n<span>'),__append(escapeFn(locals.text)),__append("</span>");return __output}},651:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<a\n  class="rss-logo"\n  href="https://rs.school/js/"\n  title="https://rs.school/js/"\n  target="_blank"\n  rel="noreferrer"\n  >\n  <img src="'),__append(escapeFn(__webpack_require__(313))),__append('" alt="rsschool" />\n</a>');return __output}},596:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_RESULT__;!function(){function aa(a,b,c){return a.call.apply(a.bind,arguments)}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function p(a,b,c){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba).apply(null,arguments)}var q=Date.now||function(){return+new Date};function ca(a,b){this.a=a,this.o=b||a,this.c=this.o.document}var da=!!window.FontFace;function t(a,b,c,d){if(b=a.c.createElement(b),c)for(var e in c)c.hasOwnProperty(e)&&("style"==e?b.style.cssText=c[e]:b.setAttribute(e,c[e]));return d&&b.appendChild(a.c.createTextNode(d)),b}function u(a,b,c){(a=a.c.getElementsByTagName(b)[0])||(a=document.documentElement),a.insertBefore(c,a.lastChild)}function v(a){a.parentNode&&a.parentNode.removeChild(a)}function w(a,b,c){b=b||[],c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}for(b=[],e=0;e<d.length;e+=1){for(f=!1,g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function y(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return!0;return!1}function z(a,b,c){function d(){m&&e&&f&&(m(g),m=null)}b=t(a,"link",{rel:"stylesheet",href:b,media:"all"});var e=!1,f=!0,g=null,m=c||null;da?(b.onload=function(){e=!0,d()},b.onerror=function(){e=!0,g=Error("Stylesheet failed to load"),d()}):setTimeout((function(){e=!0,d()}),0),u(a,"head",b)}function A(a,b,c,d){var e=a.c.getElementsByTagName("head")[0];if(e){var f=t(a,"script",{src:b}),g=!1;return f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,c&&c(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f))},e.appendChild(f),setTimeout((function(){g||(g=!0,c&&c(Error("Script load timeout")))}),d||5e3),f}return null}function B(){this.a=0,this.c=null}function C(a){return a.a++,function(){a.a--,D(a)}}function E(a,b){a.c=b,D(a)}function D(a){0==a.a&&a.c&&(a.c(),a.c=null)}function F(a){this.a=a||"-"}function G(a,b){this.c=a,this.f=4,this.a="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.a=c[1],this.f=parseInt(c[2],10))}function I(a){var b=[];a=a.split(/,\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['"]/g,"");-1!=d.indexOf(" ")||/^\d/.test(d)?b.push("'"+d+"'"):b.push(d)}return b.join(",")}function J(a){return a.a+a.f}function H(a){var b="normal";return"o"===a.a?b="oblique":"i"===a.a&&(b="italic"),b}function ga(a){var b=4,c="n",d=null;return a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10)))),c+b}function ha(a,b){this.c=a,this.f=a.o.document.documentElement,this.h=b,this.a=new F("-"),this.j=!1!==b.events,this.g=!1!==b.classes}function L(a){if(a.g){var b=y(a.f,a.a.c("wf","active")),c=[],d=[a.a.c("wf","loading")];b||c.push(a.a.c("wf","inactive")),w(a.f,c,d)}K(a,"inactive")}function K(a,b,c){a.j&&a.h[b]&&(c?a.h[b](c.c,J(c)):a.h[b]())}function ja(){this.c={}}function M(a,b){this.c=a,this.f=b,this.a=t(this.c,"span",{"aria-hidden":"true"},this.f)}function N(a){u(a.c,"body",a.a)}function O(a){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+I(a.c)+";font-style:"+H(a)+";font-weight:"+a.f+"00;"}function P(a,b,c,d,e,f){this.g=a,this.j=b,this.a=d,this.c=c,this.f=e||3e3,this.h=f||void 0}function Q(a,b,c,d,e,f,g){this.v=a,this.B=b,this.c=c,this.a=d,this.s=g||"BESbswy",this.f={},this.w=e||3e3,this.u=f||null,this.m=this.j=this.h=this.g=null,this.g=new M(this.c,this.s),this.h=new M(this.c,this.s),this.j=new M(this.c,this.s),this.m=new M(this.c,this.s),a=O(a=new G(this.a.c+",serif",J(this.a))),this.g.a.style.cssText=a,a=O(a=new G(this.a.c+",sans-serif",J(this.a))),this.h.a.style.cssText=a,a=O(a=new G("serif",J(this.a))),this.j.a.style.cssText=a,a=O(a=new G("sans-serif",J(this.a))),this.m.a.style.cssText=a,N(this.g),N(this.h),N(this.j),N(this.m)}F.prototype.c=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.a)},P.prototype.start=function(){var a=this.c.o.document,b=this,c=q(),d=new Promise((function(d,e){!function f(){q()-c>=b.f?e():a.fonts.load(function fa(a){return H(a)+" "+a.f+"00 300px "+I(a.c)}(b.a),b.h).then((function(a){1<=a.length?d():setTimeout(f,25)}),(function(){e()}))}()})),e=null,f=new Promise((function(a,d){e=setTimeout(d,b.f)}));Promise.race([f,d]).then((function(){e&&(clearTimeout(e),e=null),b.g(b.a)}),(function(){b.j(b.a)}))};var R={D:"serif",C:"sans-serif"},S=null;function T(){if(null===S){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);S=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return S}function la(a,b,c){for(var d in R)if(R.hasOwnProperty(d)&&b===a.f[R[d]]&&c===a.f[R[d]])return!0;return!1}function U(a){var d,b=a.g.a.offsetWidth,c=a.h.a.offsetWidth;(d=b===a.f.serif&&c===a.f["sans-serif"])||(d=T()&&la(a,b,c)),d?q()-a.A>=a.w?T()&&la(a,b,c)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?V(a,a.v):V(a,a.B):function ma(a){setTimeout(p((function(){U(this)}),a),50)}(a):V(a,a.v)}function V(a,b){setTimeout(p((function(){v(this.g.a),v(this.h.a),v(this.j.a),v(this.m.a),b(this.a)}),a),0)}function W(a,b,c){this.c=a,this.a=b,this.f=0,this.m=this.j=!1,this.s=c}Q.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=q(),U(this)};var X=null;function na(a){0==--a.f&&a.j&&(a.m?((a=a.a).g&&w(a.f,[a.a.c("wf","active")],[a.a.c("wf","loading"),a.a.c("wf","inactive")]),K(a,"active")):L(a.a))}function oa(a){this.j=a,this.a=new ja,this.h=0,this.f=this.g=!0}function qa(a,b,c,d,e){var f=0==--a.h;(a.f||a.g)&&setTimeout((function(){var a=e||null,m=d||{};if(0===c.length&&f)L(b.a);else{b.f+=c.length,f&&(b.j=f);var h,l=[];for(h=0;h<c.length;h++){var k=c[h],n=m[k.c],r=b.a,x=k;if(r.g&&w(r.f,[r.a.c("wf",x.c,J(x).toString(),"loading")]),K(r,"fontloading",x),r=null,null===X)if(window.FontFace){x=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var xa=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);X=x?42<parseInt(x[1],10):!xa}else X=!1;r=X?new P(p(b.g,b),p(b.h,b),b.c,k,b.s,n):new Q(p(b.g,b),p(b.h,b),b.c,k,b.s,a,n),l.push(r)}for(h=0;h<l.length;h++)l[h].start()}}),0)}function ra(a,b){this.c=a,this.a=b}function sa(a,b){this.c=a,this.a=b}function ta(a,b){this.c=a||ua,this.a=[],this.f=[],this.g=b||""}W.prototype.g=function(a){var b=this.a;b.g&&w(b.f,[b.a.c("wf",a.c,J(a).toString(),"active")],[b.a.c("wf",a.c,J(a).toString(),"loading"),b.a.c("wf",a.c,J(a).toString(),"inactive")]),K(b,"fontactive",a),this.m=!0,na(this)},W.prototype.h=function(a){var b=this.a;if(b.g){var c=y(b.f,b.a.c("wf",a.c,J(a).toString(),"active")),d=[],e=[b.a.c("wf",a.c,J(a).toString(),"loading")];c||d.push(b.a.c("wf",a.c,J(a).toString(),"inactive")),w(b.f,d,e)}K(b,"fontinactive",a),na(this)},oa.prototype.load=function(a){this.c=new ca(this.j,a.context||this.j),this.g=!1!==a.events,this.f=!1!==a.classes,function pa(a,b,c){var d=[],e=c.timeout;!function ia(a){a.g&&w(a.f,[a.a.c("wf","loading")]),K(a,"loading")}(b);d=function ka(a,b,c){var e,d=[];for(e in b)if(b.hasOwnProperty(e)){var f=a.c[e];f&&d.push(f(b[e],c))}return d}(a.a,c,a.c);var f=new W(a.c,b,e);for(a.h=d.length,b=0,c=d.length;b<c;b++)d[b].load((function(b,d,c){qa(a,f,b,d,c)}))}(this,new ha(this.c,a),a)},ra.prototype.load=function(a){function b(){if(f["__mti_fntLst"+d]){var h,c=f["__mti_fntLst"+d](),e=[];if(c)for(var l=0;l<c.length;l++){var k=c[l].fontfamily;null!=c[l].fontStyle&&null!=c[l].fontWeight?(h=c[l].fontStyle+c[l].fontWeight,e.push(new G(k,h))):e.push(new G(k))}a(e)}else setTimeout((function(){b()}),50)}var c=this,d=c.a.projectId,e=c.a.version;if(d){var f=c.c.o;A(this.c,(c.a.api||"https://fast.fonts.net/jsapi")+"/"+d+".js"+(e?"?v="+e:""),(function(e){e?a([]):(f["__MonotypeConfiguration__"+d]=function(){return c.a},b())})).id="__MonotypeAPIScript__"+d}else a([])},sa.prototype.load=function(a){var b,c,d=this.a.urls||[],e=this.a.families||[],f=this.a.testStrings||{},g=new B;for(b=0,c=d.length;b<c;b++)z(this.c,d[b],C(g));var m=[];for(b=0,c=e.length;b<c;b++)if((d=e[b].split(":"))[1])for(var h=d[1].split(","),l=0;l<h.length;l+=1)m.push(new G(d[0],h[l]));else m.push(new G(d[0]));E(g,(function(){a(m,f)}))};var ua="https://fonts.googleapis.com/css";function ya(a){this.f=a,this.a=[],this.c={}}var za={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Aa={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ba={i:"i",italic:"i",n:"n",normal:"n"},Ca=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Ea(a,b){this.c=a,this.a=b}var Fa={Arimo:!0,Cousine:!0,Tinos:!0};function Ga(a,b){this.c=a,this.a=b}function Ha(a,b){this.c=a,this.f=b,this.a=[]}Ea.prototype.load=function(a){var b=new B,c=this.c,d=new ta(this.a.api,this.a.text),e=this.a.families;!function va(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d].split(":");3==e.length&&a.f.push(e.pop());var f="";2==e.length&&""!=e[1]&&(f=":"),a.a.push(e.join(f))}}(d,e);var f=new ya(e);!function Da(a){for(var b=a.f.length,c=0;c<b;c++){var d=a.f[c].split(":"),e=d[0].replace(/\+/g," "),f=["n4"];if(2<=d.length){var g;if(g=[],m=d[1])for(var m,h=(m=m.split(",")).length,l=0;l<h;l++){var k;if((k=m[l]).match(/^[\w-]+$/))if(null==(n=Ca.exec(k.toLowerCase())))k="";else{if(k=null==(k=n[2])||""==k?"n":Ba[k],null==(n=n[1])||""==n)n="4";else var n=Aa[n]||(isNaN(n)?"4":n.substr(0,1));k=[k,n].join("")}else k="";k&&g.push(k)}0<g.length&&(f=g),3==d.length&&(g=[],0<(d=(d=d[2])?d.split(","):g).length&&(d=za[d[0]])&&(a.c[e]=d))}for(a.c[e]||(d=za[e])&&(a.c[e]=d),d=0;d<f.length;d+=1)a.a.push(new G(e,f[d]))}}(f),z(c,function wa(a){if(0==a.a.length)throw Error("No fonts to load!");if(-1!=a.c.indexOf("kit="))return a.c;for(var b=a.a.length,c=[],d=0;d<b;d++)c.push(a.a[d].replace(/ /g,"+"));return b=a.c+"?family="+c.join("%7C"),0<a.f.length&&(b+="&subset="+a.f.join(",")),0<a.g.length&&(b+="&text="+encodeURIComponent(a.g)),b}(d),C(b)),E(b,(function(){a(f.a,f.c,Fa)}))},Ga.prototype.load=function(a){var b=this.a.id,c=this.c.o;b?A(this.c,(this.a.api||"https://use.typekit.net")+"/"+b+".js",(function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var e=[],f=0;f<b.length;f+=2)for(var g=b[f],m=b[f+1],h=0;h<m.length;h++)e.push(new G(g,m[h]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(l){}a(e)}}),2e3):a([])},Ha.prototype.load=function(a){var b=this.f.id,c=this.c.o,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var g=0,m=c.fonts.length;g<m;++g){var h=c.fonts[g];d.a.push(new G(h.name,ga("font-weight:"+h.weight+";font-style:"+h.style)))}a(d.a)},A(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function ea(a){return a.o.location.hostname||a.a.location.hostname}(this.c)+"/"+b+".js",(function(b){b&&a([])}))):a([])};var Y=new oa(window);Y.a.c.custom=function(a,b){return new sa(b,a)},Y.a.c.fontdeck=function(a,b){return new Ha(b,a)},Y.a.c.monotype=function(a,b){return new ra(b,a)},Y.a.c.typekit=function(a,b){return new Ga(b,a)},Y.a.c.google=function(a,b){return new Ea(b,a)};var Z={load:p(Y.load,Y)};void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return Z}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()},313:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=__webpack_require__.p+"images/rsslogo-94a4934e.svg"}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),__webpack_require__.p="";var __webpack_exports__={};(()=>{"use strict";var header=__webpack_require__(319),header_default=__webpack_require__.n(header),footer=__webpack_require__(207),footer_default=__webpack_require__.n(footer),main=__webpack_require__(544),main_default=__webpack_require__.n(main);const insert=template=>{document.body.insertAdjacentHTML("beforeend",template)},layout=()=>{insert(header_default()()),insert(main_default()()),insert(footer_default()())},STATUS_IDLE=0,STATUS_RUNNING=1,STATUS_STOPPED=2,MOUSE_LEFT=0,MOUSE_RIGHT=2,constants_RESULT_WIN="win",constants_RESULT_LOSS="loss",constants_DIFFICULTY_EASY="easy",constants_DIFFICULTY_MEDIUM="medium",constants_DIFFICULTY_EXPERT="expert",THEME_DARK="dark",THEME_LIGHT="light",RESOURCES_MINE="mine",RESOURCES_FLAG="flag",RESOURCES_PLAYING_ICON="playing",RESOURCES_LOSS_ICON="loss",RESOURCES_WIN_ICON="win",RESOURCES_MOUSE="mouse",RESOURCES_CLOCK="clock",RESOURCES_EXPLOSION="explosion",RESOURCES_SOUND={OPEN:"open",CHORD:"chord",BOOM:"boom",WIN:"win",LOSS:"loss",FLAG:"flag"},config={getCellSize:difficulty=>difficulty===constants_DIFFICULTY_EXPERT?20:24,flagSize:12,mineSize:14,headerHeight:40,counterWidth:50,resetBtnSize:30,gameOverModalDelay:1e3},js_config=config;function randomNumber(min,max){return Math.floor(Math.random()*(max-min+1)+min)}function renderNumber(n,len=3){const s=n.toString();return s.length<len?"0".repeat(len-s.length)+s:s}function renderTime(timeMs){const ms=renderNumber(timeMs%1e3,3);return`${renderNumber(Math.floor(timeMs/1e3),1)}.${ms}`}class CellKey{constructor(x,y){"number"==typeof x&&"number"==typeof y?(this.x=x,this.y=y):"string"==typeof x&&void 0===y&&(this.value=x)}get x(){return this._x}set x(newX){this._x=Number(newX)}get y(){return this._y}set y(newY){this._y=Number(newY)}get value(){return`${this.x}-${this.y}`}set value(newValue){const[x,y]=newValue.split("-");this.x=x,this.y=y}toString(){return this.value}valueOf(){return this.value}}class CellState extends EventTarget{constructor(key){super(),this.status=CellState.STATUS.CLOSED,this.value=CellState.VALUE.EMPTY,this.key=key,this.borders=[],this.isHighlighted=!1,this.errorHighlighted=!1}getKey(){return this.key.value}get isHighlighted(){return this._isHighlighted}set isHighlighted(value){this._isHighlighted=value,this.dispatchEvent(new CustomEvent("stateChange"))}get errorHighlighted(){return this._errorHighlighted}set errorHighlighted(value){this._errorHighlighted=value,this.dispatchEvent(new CustomEvent("stateChange"))}get status(){return this._status}set status(newStatus){this._status=newStatus,this.dispatchEvent(new CustomEvent("statusChange",{detail:{cell:this}})),this.dispatchEvent(new CustomEvent("stateChange"))}get value(){return this._value}set value(newValue){this._value=newValue}get isOpened(){return this._status===CellState.STATUS.OPENED}get isClosed(){return this._status===CellState.STATUS.CLOSED}get isFlagged(){return this._status===CellState.STATUS.FLAGGED}get isNumber(){return CellState.isNumberValue(this._value)}get isEmpty(){return this._value===CellState.VALUE.EMPTY}get isMined(){return this._value===CellState.VALUE.MINE}}CellState.isNumberValue=value=>value>0&&value<=8,CellState.STATUS={CLOSED:0,OPENED:1,FLAGGED:2},CellState.VALUE={EMPTY:0,MINE:9,N_1:1,N_2:2,N_3:3,N_4:4,N_5:5,N_6:6,N_7:7,N_8:8};const createDifficulty=(width,height,mines)=>({width,height,mines}),js_difficulty={[constants_DIFFICULTY_EASY]:createDifficulty(10,10,10),[constants_DIFFICULTY_MEDIUM]:createDifficulty(15,15,40),[constants_DIFFICULTY_EXPERT]:createDifficulty(25,25,99)};var webfontloader=__webpack_require__(596),webfontloader_default=__webpack_require__.n(webfontloader);class LocalStorage{constructor(key){this.key=key}get(){const data=localStorage.getItem(this.key);if(null!==data)try{return JSON.parse(data)}catch(error){return console.log("Cant parse data from LS:",error.message)}}set(data){localStorage.setItem(this.key,JSON.stringify(data))}}class Volume extends EventTarget{constructor(value){super(),this.className="volume",this.thumbWidth=16,this.mouseMoveHandler=null,this.isThumbDragged=!1,this.containerEl=document.querySelector(`.${this.className}__bar-container`),this.barEl=document.querySelector(`.${this.className}__bar`),this.thumbEl=document.querySelector(`.${this.className}__thumb`),this.thumbEl.addEventListener("mousedown",this.handleThumbMouseDown),this.thumbEl.addEventListener("touchstart",this.handleThumbMouseDown),this.containerEl.addEventListener("click",this.handleClick),this.thumbCenterOffsetX=0,this.value=value}get value(){return this._value}set value(newValue){this._value=newValue;const width=100*this.value;this.barEl.style.width=`${width}%`,this.thumbEl.style.left=`calc(${width}% - ${this.thumbWidth/2}px)`,this.containerEl.setAttribute("title",`Volume ${Math.trunc(width)}%`)}handleClick=e=>{if(e.target.classList.contains(`${this.className}__thumb`))return;const rect=e.currentTarget.getBoundingClientRect(),x="touchmove"===e.type?e.touches[0].pageX:e.pageX;if(x<rect.left||x>rect.right)return;const xInside=e.pageX-rect.x-this.thumbCenterOffsetX;this.value=xInside/rect.width,this.dispatchEvent(new CustomEvent("volumeChange",{detail:{volume:this.value}}))};handleMouseMove=bounds=>e=>{const x=("touchmove"===e.type?e.touches[0].pageX:e.pageX)-this.thumbCenterOffsetX;if(x<bounds.left||x>bounds.right)return;const xInside=x-bounds.left;this.value=xInside/bounds.width};handleMouseUp=e=>{"touchend"===e.type?(document.removeEventListener("touchmove",this.mouseMoveHandler),document.removeEventListener("touchend",this.handleMouseUp)):(document.removeEventListener("mousemove",this.mouseMoveHandler),document.removeEventListener("mouseup",this.handleMouseUp)),this.isThumbDragged=!1,this.thumbEl.classList.remove("dragged"),this.dispatchEvent(new CustomEvent("volumeChange",{detail:{volume:this.value}}))};handleThumbMouseDown=e=>{if(e.preventDefault(),this.isThumbDragged)return;this.isThumbDragged=!0,this.thumbCenterOffsetX=e.offsetX-this.thumbWidth/2;const{x,right,width}=this.containerEl.getBoundingClientRect();this.mouseMoveHandler=this.handleMouseMove({left:x,right,width}),"touchstart"===e.type?(document.addEventListener("touchmove",this.mouseMoveHandler),document.addEventListener("touchend",this.handleMouseUp)):(document.addEventListener("mousemove",this.mouseMoveHandler),document.addEventListener("mouseup",this.handleMouseUp)),this.thumbEl.classList.add("dragged")}}class Settings extends EventTarget{constructor(){super(),this.storage=new LocalStorage(Settings.STORAGE_KEY);const stored=this.storage.get()||{},difficultyKey=stored.difficultyKey||constants_DIFFICULTY_EASY;this.values={volume:stored.volume||.3,theme:stored.theme||THEME_LIGHT,difficultyKey,numOfMines:stored.numOfMines||js_difficulty[difficultyKey].mines}}init(){const{volume,theme,difficultyKey,numOfMines}=this.values;this.volumeEl=new Volume(volume),this.volumeEl.addEventListener("volumeChange",this.handleVolumeChange),this.difficultySelect=document.querySelector('select[name="difficulty"]'),this.difficultySelect.value=difficultyKey,this.difficultySelect.addEventListener("change",this.handleDifficultyChange),this.themeSelect=document.querySelector('select[name="theme"]'),this.themeSelect.value=theme,this.themeSelect.addEventListener("change",this.handleThemeChange),this.minesInput=document.querySelector('.mines-input input[type="number"]'),this.minesInput.value=numOfMines,this.form=document.querySelector(".settings__form"),this.form.addEventListener("submit",this.handleFormSubmit),this.changeTheme(),this.dispatchEvent(new CustomEvent("difficultyChange",{detail:{difficultyKey,numOfMines}}))}get difficultyKey(){return this._values.difficultyKey}get theme(){return this._values.theme}get volume(){return this._values.volume}get values(){return this._values}set values(newValues){this._values={...this._values,...newValues},this.saveToStorage()}handleVolumeChange=e=>{this.values={volume:e.detail.volume}};saveToStorage(){this.storage.set(this.values)}changeTheme=()=>{const{theme}=this.values;document.querySelector("[data-theme]").dataset.theme=theme,this.dispatchEvent(new CustomEvent("themeChange",{detail:{theme}}))};handleThemeChange=e=>{this.values={theme:e.target.value},this.changeTheme()};handleDifficultyChange=e=>{const{value}=e.target;if(value!==this.values.difficultyKey){const defaultMines=js_difficulty[value].mines;this.values={difficultyKey:value,numOfMines:defaultMines},this.minesInput.value=defaultMines}};handleFormSubmit=e=>{e.preventDefault();const formData=new FormData(e.currentTarget);this.values={numOfMines:Number(formData.get("mines"))};const{numOfMines,difficultyKey}=this.values;this.dispatchEvent(new CustomEvent("difficultyChange",{detail:{difficultyKey,numOfMines}}))}}Settings.STORAGE_KEY="minesweeper/settings";const settings=new Settings;const resources=new class Resources{constructor(){this.images=new Map,this.sounds=new Map}addImage(key,src){this.images.set(key,src)}getImage(key){const themedKey=`${key}/${settings.theme}`,hasThemedKey=this.images.has(themedKey);return this.images.get(hasThemedKey?themedKey:key)}addSound(key,src){this.sounds.set(key,src)}getSound(key){return this.sounds.get(key)}playSound(key){const sound=new Audio(this.getSound(key).src);sound.volume=settings.volume,sound.play()}load=async()=>{await Promise.all([...this.images.entries()].map((([key,src])=>new Promise((resolve=>{var imageSrc;(imageSrc=`resources/images/${src}`,new Promise(((resolve,reject)=>{const img=new Image;img.src=imageSrc,img.onload=()=>resolve(img),img.onerror=err=>reject(err)}))).then((img=>{this.images.set(key,img),resolve()}))}))))),await Promise.all([...this.sounds.entries()].map((([key,src])=>new Promise((resolve=>{var soundSrc;(soundSrc=`resources/sounds/${src}`,new Promise(((resolve,reject)=>{const sound=new Audio(soundSrc);sound.oncanplaythrough=()=>resolve(sound),sound.onerror=err=>reject(err)}))).then((sound=>{this.sounds.set(key,sound),resolve()}))}))))),await new Promise((resolve=>{webfontloader_default().load({google:{families:["Martian Mono:100,300,400,700"]},active:resolve})}))}};resources.addImage(`${RESOURCES_MINE}/${THEME_LIGHT}`,"mine-light.svg"),resources.addImage(`${RESOURCES_MINE}/${THEME_DARK}`,"mine-dark.svg"),resources.addImage(`${RESOURCES_FLAG}/${THEME_LIGHT}`,"flag-light.svg"),resources.addImage(`${RESOURCES_FLAG}/${THEME_DARK}`,"flag-dark.svg"),resources.addImage(RESOURCES_PLAYING_ICON,"playing.png"),resources.addImage(RESOURCES_LOSS_ICON,"loss.png"),resources.addImage(RESOURCES_WIN_ICON,"win.png"),resources.addImage(RESOURCES_MOUSE,"hand.svg"),resources.addImage(RESOURCES_CLOCK,"clock.svg"),resources.addImage(RESOURCES_EXPLOSION,"explosion3.png"),resources.addSound(RESOURCES_SOUND.OPEN,"open.mp3"),resources.addSound(RESOURCES_SOUND.CHORD,"chord.mp3"),resources.addSound(RESOURCES_SOUND.BOOM,"boom.mp3"),resources.addSound(RESOURCES_SOUND.WIN,"win.mp3"),resources.addSound(RESOURCES_SOUND.LOSS,"loss.mp3"),resources.addSound(RESOURCES_SOUND.FLAG,"flag2.mp3");const checks={topLeft:[-1,-1],top:[-1,0],topRight:[-1,1],left:[0,-1],right:[0,1],bottomLeft:[1,-1],bottom:[1,0],bottomRight:[1,1]},defaultClicks={left:0,right:0,wasted:0,chords:0};class GameState extends EventTarget{constructor(difficultyKey=constants_DIFFICULTY_EASY){super(),this.difficultyKey=difficultyKey,this.isDifficultyChanged=!0,this.numOfMines=js_difficulty[this.difficultyKey].mines,this.cellsToOpenAmount=0,this.cellsOpenedCounter=0,this.clicks={...defaultClicks},this.clicksCounter=0,this.isMouseDown=!1,this.highlighted={targetKey:null,cellKeys:[]}}get numOfMines(){return this._numOfMines}set numOfMines(value){this._numOfMines=value,this.flagsCounter=value}unhighlightCells=()=>{if(0!==this.highlighted.cellKeys.length){for(const key of this.highlighted.cellKeys)this.getCell(key).isHighlighted=!1;this.highlighted={targetKey:null,cellKeys:[]}}};highlightCells=cellKey=>{const{isOpened}=this.getCell(cellKey);if(isOpened){this.highlighted.targetKey=cellKey,this.highlighted.cellKeys=this.getHighlightedCells(cellKey);for(const key of this.highlighted.cellKeys)this.getCell(key).isHighlighted=!0}};set clicksCounter(value){this.clicks.left=value,this.dispatchEvent(new CustomEvent("clicksCounterChange",{detail:{amount:this.clicks.left}}))}get clicksCounter(){return this.clicks.left}set flagsCounter(value){this._flagsCounter=value,this.dispatchEvent(new CustomEvent("flagsCounterChange",{detail:{amount:this._flagsCounter}}))}get flagsCounter(){return this._flagsCounter}set status(value){this._status=value,this.dispatchEvent(new CustomEvent("statusChange",{detail:{status:this._status}}))}get status(){return this._status}getCell=cellKey=>{if(this._checkCell(cellKey))return this.state[cellKey.x][cellKey.y]};_checkCell=cellKey=>void 0!==this.state[cellKey.x]&&void 0!==this.state[cellKey.x][cellKey.y];startGame=cellKey=>{this.status===STATUS_IDLE&&(this.status=STATUS_RUNNING,this.generateState(cellKey))};flagCell=cellKey=>{this.startGame(cellKey),this.clicks.right+=1;const cell=this.getCell(cellKey);return cell.isOpened||(cell.isFlagged?(this.flagsCounter+=1,cell.status=CellState.STATUS.CLOSED):(this.flagsCounter-=1,cell.status=CellState.STATUS.FLAGGED),resources.playSound(RESOURCES_SOUND.FLAG)),this.flagsCounter};openCell=(cellKey,isSoundPlayed=!1)=>{let sound=null;const cell=this.getCell(cellKey);if(!(cell.isFlagged||cell.isOpened&&(cell.isMined||cell.isEmpty))){if(cell.isOpened&&cell.isNumber){const cells=this.getHighlightedCells(cellKey);return 0===cells.length||cell.value>this.countFlagsAround(cellKey)?void(this.clicks.wasted+=1):(this.clicks.chords+=1,sound=cells.length>2?RESOURCES_SOUND.CHORD:RESOURCES_SOUND.OPEN,cells.forEach((cellKey=>this.openCell(cellKey,!0))),void(isSoundPlayed||resources.playSound(sound)))}sound=RESOURCES_SOUND.OPEN,cell.status=CellState.STATUS.OPENED,cell.isEmpty&&(sound=RESOURCES_SOUND.CHORD,this._revealEmptySpace(cellKey)),cell.isMined&&(sound=RESOURCES_SOUND.BOOM),null===sound||isSoundPlayed&&!cell.isMined||resources.playSound(sound)}};revealCell=cellKey=>{this.startGame(cellKey),this.openCell(cellKey)};openAllMines=()=>{for(let rowIdx=0;rowIdx<this.state.length;rowIdx+=1)for(let colIdx=0;colIdx<this.state[rowIdx].length;colIdx+=1){const cellKey=new CellKey(rowIdx,colIdx),cell=this.getCell(cellKey);cell.isMined&&cell.isClosed&&(cell.status=CellState.STATUS.OPENED)}};handleCellStatusChange=e=>{if(this.status!==STATUS_RUNNING)return;const{cell}=e.detail;cell.isOpened&&this.handleCellOpen(cell)};handleCellOpen=cellState=>{if(cellState.isMined)return this.handleLose(cellState);this.cellsOpenedCounter+=1,this.cellsOpenedCounter===this.cellsToOpenAmount&&(this.status=STATUS_STOPPED,this.openAllMines(),this.result=constants_RESULT_WIN,this.dispatchEvent(new CustomEvent("gameOver",{detail:{result:constants_RESULT_WIN}})))};highlightErrors=mineKey=>{for(const cellKey of[mineKey,...this._findWrongFlags()])this.getCell(cellKey).errorHighlighted=!0};handleLose=cellState=>{this.status=STATUS_STOPPED,this.openAllMines(),this.highlightErrors(cellState.key),this.result=constants_RESULT_LOSS,this.dispatchEvent(new CustomEvent("gameOver",{detail:{result:constants_RESULT_LOSS,mine:cellState.key}}))};getGameResult=()=>{if(this.status!==STATUS_STOPPED)return null;const{result,time,clicks}=this;return{difficulty:this.difficultyKey,result,time,clicks}};countFlagsAround=cellKey=>Object.values(checks).reduce(((counter,[dx,dy])=>{const newCellKey=new CellKey(cellKey.x+dx,cellKey.y+dy),cell=this.getCell(newCellKey);return counter+(cell?cell.isFlagged:0)}),0);getHighlightedCells=cellKey=>Object.values(checks).reduce(((cells,[dx,dy])=>{const newCellKey=new CellKey(cellKey.x+dx,cellKey.y+dy),cell=this.getCell(newCellKey);return cell&&cell.isClosed&&cells.push(newCellKey),cells}),[]);generateState=cellKey=>{this._generateMines(cellKey),this._generateNumbers()};handleDifficultyChange=({difficultyKey,numOfMines})=>{const isChanged=difficultyKey!==this.difficultyKey||numOfMines!==this.numOfMines;return isChanged&&this.reset(difficultyKey,numOfMines),isChanged};reset=(newDifficulty=this.difficultyKey,numOfMines=this.numOfMines)=>{this.numOfMines=numOfMines,this.isDifficultyChanged=this.difficultyKey!==newDifficulty,this.difficultyKey=newDifficulty,this.isCustom=js_difficulty[newDifficulty].mines!==this.numOfMines,this.clicksCounter=0,this.clicks={...defaultClicks},this.cellsToOpenAmount=0,this.cellsOpenedCounter=0,this.result=null,this.cellKeys=[],this.state=this._generateInitialMatrix(),this.status=STATUS_IDLE};_findWrongFlags=()=>{const wrongFlagsKeys=[];for(let rowIdx=0;rowIdx<this.state.length;rowIdx+=1)for(let colIdx=0;colIdx<this.state[rowIdx].length;colIdx+=1){const cellKey=new CellKey(rowIdx,colIdx),cell=this.getCell(cellKey);cell.isFlagged&&!cell.isMined&&wrongFlagsKeys.push(cellKey)}return wrongFlagsKeys};_revealEmptySpace=cellKey=>{const reveal=(key,cellKey)=>{const[dx,dy]=checks[key],newCellKey=new CellKey(cellKey.x+dx,cellKey.y+dy),cell=this.getCell(newCellKey);!cell||cell.isOpened||cell.isFlagged||(cell.isNumber?cell.status=CellState.STATUS.OPENED:cell.isEmpty&&(cell.status=CellState.STATUS.OPENED,Object.keys(checks).forEach((checkKey=>reveal(checkKey,newCellKey)))))};Object.keys(checks).forEach((key=>reveal(key,cellKey)))};_generateInitialMatrix=()=>{const{width,height}=js_difficulty[this.difficultyKey],matrix=[];for(let rowIdx=0;rowIdx<height;rowIdx+=1){matrix.push(new Array(width).fill(null));for(let colIdx=0;colIdx<width;colIdx+=1){const cellKey=new CellKey(rowIdx,colIdx);this.cellKeys.push(cellKey);const cell=new CellState(cellKey);cell.addEventListener("statusChange",this.handleCellStatusChange),matrix[rowIdx][colIdx]=cell}}return matrix};_generateMines=excludedCellKey=>{const{width,height}=js_difficulty[this.difficultyKey],mines={};for(let k=0;k<this.numOfMines;k+=1){let newCellKey;do{newCellKey=new CellKey(randomNumber(0,height-1),randomNumber(0,width-1))}while(mines[newCellKey.value]||newCellKey.value===excludedCellKey.value);mines[newCellKey.value]=1;this.getCell(newCellKey).value=CellState.VALUE.MINE}};_countNeighboringMines=cellKey=>Object.values(checks).reduce(((counter,[dx,dy])=>{const newCellKey=new CellKey(cellKey.x+dx,cellKey.y+dy),cell=this.getCell(newCellKey);return counter+(cell?cell.isMined:0)}),0);_generateNumbers=()=>{for(let rowIdx=0;rowIdx<this.state.length;rowIdx+=1)for(let colIdx=0;colIdx<this.state[rowIdx].length;colIdx+=1){const cellKey=new CellKey(rowIdx,colIdx),cell=this.getCell(cellKey);if(!cell.isMined){this.cellsToOpenAmount+=1;const value=this._countNeighboringMines(cellKey);cell.value=value}}}}const game_state=new GameState;class Point{constructor(x,y){this.x=x,this.y=y}}const theme={[THEME_LIGHT]:{bgColor:"#f0f2f5",primaryMediumColor:"rgba(38, 115, 221, 0.2)",highlightMediumColor:"rgba(255, 122, 69, 0.6)",borderColor:"#e8e8e8",textColor:"rgba(0, 0, 0, 0.87)",cellBg:{opened:"#f0f2f5",closed:"rgba(38, 115, 221, 0.5)",flagged:"rgba(38, 115, 221, 0.5)",error:"rgba(238, 44, 74, 0.5)",hightlight:"rgba(38, 115, 221, 0.38)"},cellTextColor:["#000000","#00418d","#00ba71","#f43545","#5f2879","#ff8901","#00c2de","#fad717","teal"]},[THEME_DARK]:{bgColor:"#121212",primaryMediumColor:"rgba(38, 115, 221, 0.3)",highlightMediumColor:"rgba(255, 122, 69, 0.6)",borderColor:"rgba(255, 255, 255, 0.09)",textColor:"rgba(255, 255, 255, 0.87)",cellBg:{opened:"#272727",closed:"rgba(38, 115, 221, 0.5)",flagged:"rgba(38, 115, 221, 0.5)",error:"rgba(238, 44, 74, 0.5)",hightlight:"rgba(38, 115, 221, 0.3)"},cellTextColor:["#000000","#2673dd","#00ba71","#f43545","#be29ec","#ff8901","#00c2de","#fad717","lightgrey"]}},gameObjectOptions=(offsetX,offsetY,width=0,height=0)=>({offsetX,offsetY,width,height}),customMouseEvent=(name,detail)=>new CustomEvent(name,{detail}),customMouseEventFromReal=(name,e)=>{const{offsetX,offsetY,button}=e;return new CustomEvent(name,{detail:{offsetX,offsetY,button}})},ctxApplyStyles=ctx=>{ctx.fillStyle=theme[settings.theme].textColor,ctx.font='14px "Martian Mono"',ctx.textBaseline="middle",ctx.textAlign="center"};function applyBg(ctx,bgColor=theme[settings.theme].primaryMediumColor){ctx.save(),ctx.fillStyle=theme[settings.theme].bgColor,ctx.fillRect(0,0,this.width,this.height),ctx.fillStyle=bgColor,ctx.fillRect(0,0,this.width,this.height),ctx.restore()}class GameObject extends EventTarget{constructor(options){super();const{offset,width=0,height=0,parent,ctx}=options;this.ctx=ctx,this.parent=parent,this.offset=offset,this.width=width,this.height=height,this.right=offset.x+width,this.bottom=offset.y+height,this.objects=new Map,this.hovered=new Map,this.isHovered=!1,this.isChanged=!0}get isChanged(){return this._isChanged}set isChanged(value){this._isChanged=value,this.parent&&(this.parent.isChanged=value)}get isHovered(){return this._isHovered}set isHovered(value){this.isChanged=!0,this._isHovered=value}onChange(){this.isChanged=!0;for(const obj of this.objects.values())obj.onChange()}destroy(){for(const obj of this.objects.values())obj.destroy();this.objects.clear()}reset(){for(const obj of this.objects.values())obj.reset()}add(key,ObjectConstructor,options,...rest){const{offsetX=0,offsetY=0,width=0,height=0}=options,{x,y}=this.offset;this.objects.set(key,new ObjectConstructor({offset:new Point(x+offsetX,y+offsetY),width,height,parent:this,ctx:this.ctx},...rest))}remove(key){this.objects.delete(key)}get(key){return this.objects.get(key)}update(deltaTime){for(const obj of this.objects.values())obj.update(deltaTime)}contains(mouseX,mouseY){const{offset:{x,y},right,bottom}=this;return mouseX>=x&&mouseX<=right&&mouseY>=y&&mouseY<=bottom}drawDescendants(ctx){for(const obj of this.objects.values())obj.draw(ctx)}draw(ctx){this.drawDescendants(ctx)}drawWithOffset(ctx,cb){const{x,y}=this.offset;ctx.save(),ctx.translate(x,y),cb&&cb(),ctx.restore()}checkMousePosition(e,onContains){let isInObject=!1;const{offsetX,offsetY}=e.detail;for(const[key,obj]of this.objects.entries())obj.contains(offsetX,offsetY)&&(isInObject=!0,onContains(obj,key));return isInObject}onMouseDown(e){this.checkMousePosition(e,(obj=>(obj.dispatchEvent(e),obj.onMouseDown(e))))}onMouseUp(e){this.checkMousePosition(e,(obj=>(obj.dispatchEvent(e),obj.onMouseUp(e))))}onMouseEnter(e){this.isHovered=!0,this.dispatchEvent(e)}onMouseLeave(e){this.isHovered=!1,this.dispatchEvent(e);for(const v of this.hovered.values())v.onMouseLeave(e);this.hovered.clear()}unhover=e=>{for(const v of this.hovered.values())v.onMouseLeave(customMouseEvent("mouseleave",e.detail));this.hovered.clear()};onMouseMove(e){this.checkMousePosition(e,((obj,key)=>(obj.dispatchEvent(e),this.hovered.has(key)||(this.unhover(e),this.hovered.set(key,obj),obj.onMouseEnter(customMouseEvent("mouseenter",e.detail))),obj.onMouseMove(e))))||this.unhover(e)}setCursor(cursor="pointer"){this.addEventListener("mouseenter",(()=>{document.body.style.cursor=cursor})),this.addEventListener("mouseleave",(()=>{document.body.style.cursor="default"}))}}class CachedGameObject extends GameObject{constructor(options){super(options),this.cacheCanvas=document.createElement("canvas"),this.cacheCanvas.width=options.width,this.cacheCanvas.height=options.height,this.cacheCtx=this.cacheCanvas.getContext("2d"),ctxApplyStyles(this.cacheCtx),this.isCached=!0}applyStyles(styles){Object.keys(styles).forEach((key=>{this.cacheCtx[key]=styles[key]}))}drawDescendants(ctx,redraw){for(const obj of this.objects.values())(obj.isChanged||redraw)&&obj.draw(ctx)}drawCached(ctx,draw,redraw=!1){if(this.isChanged&&(draw&&draw(this.cacheCtx),this.drawDescendants(this.cacheCtx,redraw),this.isChanged=!1),this.parent&&this.parent.isCached){const{offset}=this.parent;ctx.drawImage(this.cacheCanvas,this.offset.x-offset.x,this.offset.y-offset.y)}else this.drawWithOffset(ctx,(()=>{ctx.drawImage(this.cacheCanvas,0,0)}),0)}}class ImageObject extends GameObject{constructor(options,resourceKey,imgHeight,position="center"){const{width,height}=resources.getImage(resourceKey),flagSizeRatio=width/height,imgWidth=Math.floor(imgHeight*flagSizeRatio),{parent}=options;let offsetX=Math.floor((parent.width-imgWidth)/2),offsetY=Math.floor((parent.height-imgHeight)/2);"right"===position&&(offsetX=parent.width-imgWidth),"left"===position&&(offsetX=0),super({...options,offset:new Point(offsetX,offsetY),width:imgWidth,height:imgHeight}),this.resourceKey=resourceKey,this.position=position}get resourceKey(){return this._resourceKey}set resourceKey(value){this._resourceKey=value,this.isChanged=!0}draw(ctx){super.drawWithOffset(ctx,(()=>{ctx.drawImage(resources.getImage(this.resourceKey),0,0,this.width,this.height)}),0)}}class Cell extends CachedGameObject{constructor(options,state){super(options),this.state=state,this.setListeners(),game_state.addEventListener("statusChange",this.handleGameStatusChange)}destroy(){game_state.removeEventListener("statusChange",this.handleGameStatusChange),this.state.removeEventListener("statusChange",this.handleCellStatusChange),this.state.removeEventListener("stateChange",this.handleCellStateChange),super.destroy()}setListeners(){this.addEventListener("mousedown",this.handleMouseDown),this.addEventListener("mouseup",this.handleMouseUp),this.addEventListener("mouseenter",this.handleMouseEnter),this.addEventListener("mouseleave",this.handleMouseLeave),this.state.addEventListener("statusChange",this.handleCellStatusChange),this.state.addEventListener("stateChange",this.handleCellStateChange)}reset(){this.state=game_state.getCell(this.state.key),this.setListeners(),this.isChanged=!0,this.objects.clear()}handleCellStateChange=()=>{this.isChanged=!0};handleCellStatusChange=()=>{const{isOpened,isClosed,isFlagged,isMined}=this.state;isFlagged?this.add("flag",ImageObject,{},RESOURCES_FLAG,js_config.flagSize):isClosed&&this.remove("flag"),isOpened&&isMined&&this.add("mine",ImageObject,{},RESOURCES_MINE,js_config.mineSize)};handleGameStatusChange=e=>{const{status}=e.detail;status===STATUS_STOPPED&&(this.removeEventListener("mousedown",this.handleMouseDown),this.removeEventListener("mouseup",this.handleMouseUp),this.removeEventListener("mouseenter",this.handleMouseEnter),this.removeEventListener("mouseleave",this.handleMouseLeave))};handleMouseEnter=()=>{game_state.isMouseDown&&game_state.highlightCells(this.state.key)};handleMouseLeave=()=>{game_state.isMouseDown&&game_state.unhighlightCells()};handleMouseDown=e=>{if(e.detail.button===MOUSE_LEFT&&(game_state.clicksCounter+=1,game_state.highlightCells(this.state.key)),e.detail.button===MOUSE_RIGHT)return game_state.flagCell(this.state.key)};handleMouseUp=e=>{if(game_state.unhighlightCells(),e.detail.button===MOUSE_LEFT)return game_state.revealCell(this.state.key)};drawBorders(ctx){const{width,height}=this;ctx.strokeStyle=theme[settings.theme].borderColor,ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(width,0),ctx.lineTo(width,height),ctx.lineTo(0,height),ctx.stroke()}drawValue(ctx){const{width,height}=this,{value,isNumber,isEmpty}=this.state;isNumber&&!isEmpty&&(ctx.fillStyle=theme[settings.theme].cellTextColor[this.state.value],ctx.fillText(value,width/2,height/2+2))}drawBackground(ctx){const{width,height}=this,{isOpened,isFlagged,isHighlighted,errorHighlighted}=this.state;let bgColor=this.isHovered&&game_state.isMouseDown&&!isOpened&&!isFlagged?theme[settings.theme].cellBg.opened:this.getDrawStateBgColor(),hightlightColor=null;(this.isHovered&&!isOpened||isHighlighted)&&(hightlightColor=theme[settings.theme].cellBg.hightlight),errorHighlighted&&(hightlightColor=theme[settings.theme].cellBg.error),applyBg.call(this,ctx,bgColor),null!==hightlightColor&&applyBg.call(this,ctx,hightlightColor)}drawCell(ctx){this.drawBackground(ctx),this.drawBorders(ctx),this.state.isOpened&&this.drawValue(ctx)}draw(ctx){this.drawCached(ctx,(cacheCtx=>{this.drawCell(cacheCtx),super.draw(cacheCtx)}))}getDrawStateBgColor(){switch(this.state.status){case CellState.STATUS.CLOSED:return theme[settings.theme].cellBg.closed;case CellState.STATUS.OPENED:return theme[settings.theme].cellBg.opened;case CellState.STATUS.FLAGGED:return theme[settings.theme].cellBg.flagged;default:return theme[settings.theme].cellBg.closed}}}class Explosion extends CachedGameObject{constructor(options,sprite,numberOfFrames=new Point(5,5)){const{width,height}=sprite,{x,y}=numberOfFrames,frameWidth=Math.floor(width/x),frameHeight=Math.floor(height/y);super({...options,width:frameWidth,height:frameHeight}),this.numberOfFrames=numberOfFrames,this.sprite=sprite,this.frames=[null];for(let row=0;row<y;row+=1)for(let col=0;col<x;col+=1)this.frames.push(new Point(col*frameWidth,row*frameHeight));this.frames.push(null,null),this.frameIdx=0,this.time=0,this.msPerFrame=1e3/24,this.isPlaying=!1}play(position){this.offset=position,this.isPlaying=!0,this.time=0,this.frameIdx=0}stop(){return this.isPlaying=!1,!1}update(deltaTime){if(!this.isPlaying)return!1;if(this.time+=deltaTime,this.time>=this.msPerFrame){const framesToAdd=Math.trunc(this.time/this.msPerFrame);if(this.frameIdx+=framesToAdd,this.frameIdx>=this.frames.length-1)return this.stop();this.frameIdx=this.frameIdx%(this.frames.length-1),this.time=this.time-this.msPerFrame*framesToAdd,this.isChanged=!0}return this.isChanged}draw(ctx){this.drawCached(ctx,(cacheCtx=>{cacheCtx.clearRect(0,0,this.width,this.height);const frame=this.frames[this.frameIdx];if(null===frame)cacheCtx.clearRect(0,0,this.width,this.height);else{const{x,y}=frame;cacheCtx.drawImage(this.sprite,x,y,this.width,this.height,0,0,this.width,this.height)}}))}}const cellName=(row,col)=>`cell/${row}-${col}`;class Grid extends CachedGameObject{constructor(...props){super(...props),this.addCells(),this.add("explosion",Explosion,gameObjectOptions(50,50),resources.getImage(RESOURCES_EXPLOSION),new Point(4,4)),this.addEventListener("mousedown",this.handleMouseDown),this.setCursor("pointer"),game_state.addEventListener("gameOver",this.handleGameOver)}destroy(){game_state.removeEventListener("gameOver",this.handleGameOver),super.destroy()}handleGameOver=e=>{const{result}=e.detail;if(result===constants_RESULT_LOSS){const{mine}=e.detail,{offset:{x,y},width,height}=this.get(cellName(mine.x,mine.y)),exp=this.get("explosion");exp.play(new Point(x-(exp.width-width)/2,y-(exp.height-height)/2))}};handleMouseDown=e=>{game_state.isMouseDown=e.detail.button===MOUSE_LEFT,game_state.isMouseDown&&document.addEventListener("mouseup",this.documentMouseUp)};documentMouseUp=e=>{document.removeEventListener("mouseup",this.documentMouseUp),game_state.isMouseDown=!1};addCells=()=>{const{getCellSize}=js_config,cellSize=getCellSize(game_state.difficultyKey),{cellKeys}=game_state;for(const cellKey of cellKeys){const cellState=game_state.getCell(cellKey),{x:row,y:col}=cellKey,x=col*cellSize,y=row*cellSize;this.add(cellName(row,col),Cell,gameObjectOptions(x,y,cellSize,cellSize),cellState)}};update(deltaTime){this.isChange=this.get("explosion").update(deltaTime)}reset(){game_state.isDifficultyChanged||super.reset()}checkMousePosition(e,onContains){const{offsetX,offsetY}=e.detail,{getCellSize,headerHeight}=js_config,cellSize=getCellSize(game_state.difficultyKey),row=Math.floor((offsetY-headerHeight)/cellSize),col=Math.floor(offsetX/cellSize),key=cellName(row,col),obj=this.objects.get(key);return void 0!==obj&&offsetX>=obj.offset.x&&offsetY>=obj.offset.y&&(onContains(obj,key),!0)}draw(ctx){this.drawCached(ctx,null,this.isChanged)}}class Counter extends CachedGameObject{constructor(options){const{counterWidth,headerHeight}=js_config,width=0!==options.width?options.width:counterWidth;super({...options,width,height:headerHeight}),this.iconHeight=18,this.applyStyles({font:'normal 300 18px "Martian Mono"',textAlign:"left"})}draw(ctx,text){this.drawCached(ctx,(cacheCtx=>{applyBg.call(this,cacheCtx),cacheCtx.fillStyle=theme[settings.theme].textColor,cacheCtx.fillText(text,this.textOffsetX,this.height/2)}))}}class Timer extends Counter{constructor(options){super(options),this.add("clock",ImageObject,{},RESOURCES_CLOCK,this.iconHeight,"left"),this.textOffsetX=this.get("clock").width+5,this.reset(),game_state.addEventListener("statusChange",this.handleGameStatusChange)}destroy(){game_state.removeEventListener("statusChange",this.handleGameStatusChange),super.destroy()}handleGameStatusChange=e=>{const{status}=e.detail;status===STATUS_STOPPED&&(game_state.time=Math.trunc(this.time))};set time(value){this._time=value}get time(){return this._time}get seconds(){return this._seconds}set seconds(value){this._seconds=value>999?999:value,this.isChanged=!0}reset(){this.time=0,this.seconds=0}update(deltaTime){if(game_state.status!==STATUS_RUNNING)return;this.time+=deltaTime;const timeInSeconds=Math.trunc(this.time/1e3);timeInSeconds!==this.seconds&&(this.seconds=timeInSeconds)}draw(ctx){super.draw(ctx,renderNumber(this.seconds))}}class FlagsCounter extends Counter{constructor(options){super(options),this.add("flag",ImageObject,{},RESOURCES_FLAG,this.iconHeight,"right"),this.textOffsetX=5,game_state.addEventListener("flagsCounterChange",this.handleFlagCounterChange)}destroy(){game_state.removeEventListener("flagsCounterChange",this.handleFlagCounterChange),super.destroy()}handleFlagCounterChange=()=>{this.isChanged=!0};draw(ctx){super.draw(ctx,renderNumber(game_state.flagsCounter,2))}}class ResetBtn extends CachedGameObject{constructor(options){const{resetBtnSize}=js_config;super({...options,width:resetBtnSize,height:resetBtnSize}),this.add("icon",ImageObject,{},RESOURCES_PLAYING_ICON,.8*resetBtnSize),this.isBlocked=!1,game_state.addEventListener("gameOver",this.handleGameOver),this.addEventListener("mousedown",this.handleMouseDown),this.setCursor("pointer")}destroy(){game_state.removeEventListener("gameOver",this.handleGameOver),super.destroy()}reset(){this.get("icon").resourceKey=RESOURCES_PLAYING_ICON}handleMouseDown=()=>{this.isBlocked||document.addEventListener("mouseup",this.handleMouseUp)};handleMouseUp=()=>{game_state.reset(),document.removeEventListener("mouseup",this.handleMouseUp)};handleGameOver=e=>{const{result}=e.detail;this.get("icon").resourceKey=result===constants_RESULT_LOSS?RESOURCES_LOSS_ICON:RESOURCES_WIN_ICON,this.isBlocked=!0,setTimeout((()=>{this.isBlocked=!1}),js_config.gameOverModalDelay)};draw(ctx){this.drawCached(ctx,(cacheCtx=>{applyBg.call(this,cacheCtx),this.isHovered&&(cacheCtx.fillStyle=theme[settings.theme].highlightMediumColor,cacheCtx.fillRect(0,0,this.width,this.height))}))}}class ClicksCounter extends Counter{constructor(options){super(options),this.add("mouse",ImageObject,{},RESOURCES_MOUSE,this.iconHeight,"left"),this.textOffsetX=this.get("mouse").width+5,game_state.addEventListener("clicksCounterChange",this.handleClicksCounterChange)}destroy(){game_state.removeEventListener("clicksCounterChange",this.handleClicksCounterChange),super.destroy()}handleClicksCounterChange=()=>{this.isChanged=!0};draw(ctx){super.draw(ctx,renderNumber(game_state.clicksCounter,1))}}class HeaderCenter extends CachedGameObject{constructor(options,timerWidth){super(options);const{headerHeight,resetBtnSize}=js_config;this.add("timer",Timer,gameObjectOptions(0,0,timerWidth)),this.add("resetBtn",ResetBtn,gameObjectOptions(timerWidth,(headerHeight-resetBtnSize)/2))}draw(ctx){this.drawCached(ctx)}}class Header extends CachedGameObject{constructor(options){super(options);const{counterWidth,resetBtnSize}=js_config,timerWidth=counterWidth+18,headerCenterWidth=timerWidth+resetBtnSize;this.add("headerCenter",HeaderCenter,gameObjectOptions(Math.floor((this.width-headerCenterWidth)/2),0,headerCenterWidth,this.height),timerWidth),this.add("clicksCounter",ClicksCounter,gameObjectOptions(5,0,.2*this.width)),this.add("flagsCounter",FlagsCounter,gameObjectOptions(this.width-counterWidth-5,0))}draw(ctx){this.drawCached(ctx)}}class GameCanvas extends CachedGameObject{constructor(container){const canvas=(container=>{const{headerHeight,getCellSize}=js_config,cellSize=getCellSize(settings.difficultyKey),{width,height}=js_difficulty[settings.difficultyKey],canvas=document.createElement("canvas");if(!canvas.getContext)throw new Error("Canvas is unsupported");return canvas.width=cellSize*width,canvas.height=cellSize*height+headerHeight,canvas.id="game-canvas",container.append(canvas),canvas})(container),{width,height}=canvas;super({offset:new Point(0,0),width,height}),this.ctx=canvas.getContext("2d"),ctxApplyStyles(this.ctx);const{headerHeight}=js_config;this.add("grid",Grid,gameObjectOptions(0,headerHeight,width,height-headerHeight)),this.add("header",Header,gameObjectOptions(0,0,width,headerHeight)),this.time=0,canvas.addEventListener("mousedown",this.handleCanvasMouseDown),canvas.addEventListener("mouseup",this.handleCanvasMouseUp),canvas.addEventListener("mousemove",this.handleCanvasMouseMove),canvas.addEventListener("mouseleave",this.handleCanvasMouseLeave),canvas.addEventListener("contextmenu",(e=>e.preventDefault())),game_state.addEventListener("statusChange",this.handleGameStatusChange),settings.addEventListener("themeChange",this.onChange),this.gameLoop()}handleCanvasMouseDown=e=>{e.preventDefault(),super.onMouseDown(customMouseEventFromReal("mousedown",e))};handleCanvasMouseUp=e=>{super.onMouseUp(customMouseEventFromReal("mouseup",e))};handleCanvasMouseMove=e=>{super.onMouseMove(customMouseEventFromReal("mousemove",e))};handleCanvasMouseLeave=e=>{super.onMouseLeave(customMouseEventFromReal("mouseleave",e))};onChange=()=>{super.onChange()};destroy(){game_state.removeEventListener("statusChange",this.handleGameStatusChange),settings.removeEventListener("themeChange",this.onChange),super.destroy()}reset(){super.reset()}handleGameStatusChange=e=>{const{status}=e.detail;status===STATUS_IDLE&&this.reset()};gameLoop=()=>{this.update(),this.isChanged&&this.draw(),requestAnimationFrame(this.gameLoop)};update(){const currentTime=performance.now(),deltaTime=currentTime-this.time;this.time=currentTime,super.update(deltaTime)}draw(){applyBg.call(this,this.ctx),this.drawCached(this.ctx)}}var content=__webpack_require__(851),content_default=__webpack_require__.n(content),tab_content=__webpack_require__(389),tab_content_default=__webpack_require__.n(tab_content),menu=__webpack_require__(810),menu_default=__webpack_require__.n(menu),modal_close_btn=__webpack_require__(823),modal_close_btn_default=__webpack_require__.n(modal_close_btn);const defaultOptions={hideOnClickOutside:!1,onHide:null};class Modal{constructor(className,options={}){this.options={...defaultOptions,...options},this.container=document.querySelector(`.${className}`),this.container.querySelector(".modal__window").insertAdjacentHTML("afterbegin",modal_close_btn_default()()),document.querySelector(".modal__close-btn").addEventListener("click",this.hide),this.mods={show:"show",hide:"hide"},this.transition=400}removeMods=(mods=[])=>{this.container.classList.remove(...mods)};handleDocumentClick=e=>{(function isClickOutside(e,classNames){const composed=e.composedPath();return classNames.every((className=>!composed.find((el=>el.classList&&el.classList.contains(className)))))})(e,["modal__window"])&&this.hide()};show=(showMods=[])=>{this.additionalShowMods=showMods;const{options:{hideOnClickOutside}}=this;this.container.classList.add(this.mods.show,...showMods),hideOnClickOutside&&document.addEventListener("click",this.handleDocumentClick),document.body.classList.add("no-y-scroll")};hide=()=>{const{mods,transition,container,options:{hideOnClickOutside,onHide}}=this;container.classList.remove(mods.show,...this.additionalShowMods),container.classList.add(mods.hide),onHide&&onHide(),hideOnClickOutside&&document.removeEventListener("click",this.handleDocumentClick),setTimeout((()=>{container.classList.remove(mods.hide),document.body.classList.remove("no-y-scroll")}),transition)}}let callbacks=null,menuWindow=null,tabs={help:null,stats:null,settings:null},buttons={...tabs},currentTab=null,modal=null,isMenuOpened=!1;const adjustMenuHeight=tabKey=>{const tabHeight=tabs[tabKey].offsetHeight;menuWindow.style.height=`${tabHeight}px`},switchTab=tabKey=>{currentTab=tabKey,closeTabs(),tabs[tabKey].classList.add("show"),requestAnimationFrame((()=>{adjustMenuHeight(tabKey)})),buttons[tabKey].classList.add("active")},closeTabs=()=>{Object.keys(tabs).forEach((tabKey=>{menuWindow.style.overflow="hidden",tabs[tabKey].classList.contains("show")&&(tabs[tabKey].classList.remove("show"),tabs[tabKey].classList.add("hide"),setTimeout((()=>{menuWindow.style.overflow="auto",tabs[tabKey].classList.remove("hide")}),modal.transition)),buttons[tabKey].classList.remove("active")}))},onHide=()=>{isMenuOpened=!1,currentTab=null,closeTabs(),callbacks.onClose&&callbacks.onClose()},initMenu=args=>{callbacks=args,document.body.insertAdjacentHTML("afterbegin",menu_default()()),modal=new Modal("menu",{hideOnClickOutside:!0,onHide}),menuWindow=document.querySelector(".menu__window"),Object.keys(tabs).forEach((tabKey=>{tabs[tabKey]=document.querySelector(`[data-tab="${tabKey}"]`),buttons[tabKey]=document.querySelector(`[data-tab-button="${tabKey}"]`),buttons[tabKey].addEventListener("click",(tabKey=>e=>{if(e.stopPropagation(),isMenuOpened&&currentTab!==tabKey)return switchTab(tabKey);isMenuOpened=!isMenuOpened,isMenuOpened?(callbacks.onOpen&&callbacks.onOpen(),switchTab(tabKey),modal.show()):modal.hide()})(tabKey))}))};let tabTitles={[constants_DIFFICULTY_EASY]:null,[constants_DIFFICULTY_MEDIUM]:null,[constants_DIFFICULTY_EXPERT]:null},statistics_tabs={...tabTitles};const storage=new LocalStorage("minesweeper/stats");let statistics_currentTab=constants_DIFFICULTY_EASY,lastTimeGeneratedAmount=null,statistics=storage.get()||[];const statistics_switchTab=tabKey=>()=>{statistics_currentTab=tabKey,statistics_closeTabs(),statistics_tabs[tabKey].classList.add("show"),tabTitles[tabKey].classList.add("active"),adjustMenuHeight("stats")},statistics_closeTabs=()=>{Object.keys(statistics_tabs).forEach((tabKey=>{statistics_tabs[tabKey].classList.contains("show")&&statistics_tabs[tabKey].classList.remove("show"),tabTitles[tabKey].classList.remove("active")}))},findMinTime=difficulty=>{const filtred=statistics.filter((stat=>stat.difficulty===difficulty));return 0===filtred.length?1/0:filtred.reduce(((min,el)=>el.time<min.time?el:min)).time},processClicks=clicks=>{const{left,right,wasted,chords}=clicks;return`L:${left} (C:${chords}, W:${wasted}), R:${right}`},processStat=statItem=>{const{time,date,clicks}=statItem;return{...statItem,time:renderTime(time),date:new Date(date).toLocaleDateString("ru-RU"),clicks:processClicks(clicks)}};var results=__webpack_require__(504),results_default=__webpack_require__.n(results),title=__webpack_require__(695),title_default=__webpack_require__.n(title);let results_modal=null,results_title=null,results_content=null;const resultMessage=(text,imgSrc)=>title_default()({imgSrc,text});function showResults(results){const isWin="win"===results.result;results_title.innerHTML=isWin?resultMessage("Win!",resources.getImage(RESOURCES_WIN_ICON).src):resultMessage("Loss!",resources.getImage(RESOURCES_LOSS_ICON).src),results_content.innerHTML=function renderContent(isWin,data){const oldBestTime=findMinTime(data.difficulty),{time}=data,isNewBestTime=!game_state.isCustom&&isWin&&oldBestTime>time,difference=oldBestTime-time;return content_default()({difference:difference===1/0?null:renderTime(oldBestTime-time),isNewBestTime,...data,time:renderTime(time)})}(isWin,results);const resultModificator=isWin?"results_win":"results_lose";results_modal.removeMods(["results_win","results_lose"]),results_modal.show([resultModificator])}let gameCanvas=null;const createGameCanvas=()=>{null!==gameCanvas&&gameCanvas.destroy();const container=document.querySelector("#game");container.innerHTML="",gameCanvas=new GameCanvas(container)};document.addEventListener("DOMContentLoaded",(async()=>{try{await resources.load()}catch(err){return console.log(`Failed to load resource: ${err.message}`)}layout(),game_state.reset(constants_DIFFICULTY_EASY),game_state.addEventListener("gameOver",(()=>{const date=Date.now(),gameResult=game_state.getGameResult(),gameOverSound=gameResult.result===constants_RESULT_WIN?RESOURCES_SOUND.WIN:RESOURCES_SOUND.LOSS;setTimeout((()=>{resources.playSound(gameOverSound),showResults(gameResult),game_state.isCustom||(gameResult=>{gameResult.result===constants_RESULT_WIN&&(statistics.push(gameResult),storage.set(statistics.slice(-10)))})({...gameResult,clicks:{...gameResult.clicks},date})}),js_config.gameOverModalDelay)})),function initResults(){document.body.insertAdjacentHTML("afterbegin",results_default()()),results_modal=new Modal("results"),results_title=document.querySelector(".results__title"),results_content=document.querySelector(".results__content")}(),initMenu({onOpen:()=>{statistics.length!==lastTimeGeneratedAmount&&(lastTimeGeneratedAmount=statistics.length,null===tabTitles.easy&&Object.keys(tabTitles).forEach((key=>{tabTitles[key]=document.querySelector(`[data-stats-tab-title="${key}"]`),tabTitles[key].addEventListener("click",statistics_switchTab(key)),statistics_tabs[key]=document.querySelector(`[data-stats-tab="${key}"]`)})),Object.keys(statistics_tabs).forEach((difficultykey=>{const stats=statistics.filter((stat=>stat.difficulty===difficultykey)).map(processStat);statistics_tabs[difficultykey].innerHTML=tab_content_default()({stats})})),statistics_switchTab(statistics_currentTab)())}}),settings.addEventListener("difficultyChange",(e=>{game_state.handleDifficultyChange(e.detail)&&createGameCanvas(),modal&&isMenuOpened&&modal.hide(),document.querySelector("#game").className=e.detail.difficultyKey})),settings.init(),createGameCanvas()}))})()})();
//# sourceMappingURL=main-24389609.js.map